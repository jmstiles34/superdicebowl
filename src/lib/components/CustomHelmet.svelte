<script lang="ts">
	import Moveable from 'svelte-moveable';
	import {
		HELMET_SIZE,
		HELMET_WIDTH,
		NOOP,
		POSITION,
		WIDTH_DIVIDER
	} from '$lib/constants/constants';
	import { lightenColor } from '$lib/utils/common';

	export let faceMask = 'hsl(0 0% 85% / 1)';
	export let helmet = 'hsl(207 44% 49% / 1)';
	export let stripe = 'hsl(0 100% 100% / 1)';
	export let trim = 'hsl(210 100% 13% / 1)';
	export let direction = POSITION.RIGHT;
	export let logo: string | null = null;
	export let logoLeft: string | null = null;
	export let logoFixed: boolean = false;
	export let title: string = 'Custom Football Helmet';
	export let size: string = HELMET_SIZE.LARGE;
	export let logoTransform: string;
	export let logoWidth: number = HELMET_WIDTH[size] / WIDTH_DIVIDER[size];
	export let setTransform: (t: string) => void;
	export let canCustomize: boolean = false;
	let moveable: HTMLElement | null;
	let target: HTMLElement;
	let earOutline = lightenColor(helmet);

	/* function onResize({ target, width, height, delta }) {
		delta[0] && (target.style.width = `${width}px`);
		delta[1] && (target.style.height = `${height}px`);
	} */

	function onTransform(transform: string) {
		setTransform(transform);
		//console.log(transform);
	}

	function toggleMoveableTarget() {
		moveable ? (moveable = null) : (moveable = target);
	}
</script>

<div class="helmet-wrapper" {title}>
	<div
		class="helmet-rotate"
		class:small={size === HELMET_SIZE.SMALL}
		class:large={size === HELMET_SIZE.LARGE}
	>
		<svg
			class:shadow={size === HELMET_SIZE.LARGE}
			class:end-zone-shadow={size === HELMET_SIZE.SMALL}
			version="1.2"
			xmlns="http://www.w3.org/2000/svg"
			viewBox="0 0 864 864"
		>
			<defs>
				<filter id="inset-shadow">
					<!-- Shadow offset -->
					<feOffset dx="12" dy="6" />
					<!-- Shadow blur -->
					<feGaussianBlur stdDeviation="2" result="offset-blur" />
					<!-- Invert drop shadow to make an inset shadow-->
					<feComposite operator="out" in="SourceGraphic" in2="offset-blur" result="inverse" />
					<!-- Cut color inside shadow -->
					<feFlood flood-color="black" flood-opacity=".95" result="color" />
					<feComposite operator="in" in="color" in2="inverse" result="shadow" />
					<!-- Placing shadow over element -->
					<feComposite operator="over" in="shadow" in2="SourceGraphic" />
				</filter>
				<style>
					.ear-hole-shadow {
						filter: drop-shadow(4px 4px 8px hsl(0deg 0% 0% / 0.95));
					}
					.ear-hole {
						fill: var(--color-gray-900);
						filter: url(#inset-shadow);
					}
					.outline {
						fill: var(--color-offblack);
					}
					.white {
						fill: var(--color-white);
					}
					.snaps {
						fill: hsl(207 50% 88% / 1);
					}
					.snaps-outline {
						fill: hsl(207 50% 20% / 1);
					}
					.snap-shadow {
						filter: drop-shadow(8px 8px 8px hsl(0deg 0% 0% / 0.5));
					}
					.clasp-shadow {
						filter: drop-shadow(4px 4px 8px hsl(0deg 0% 0% / 0.5));
					}
					.mask-shadow {
						filter: drop-shadow(2px -2px 4px hsl(0deg 0% 30% / 0.75));
					}
					.stroke {
						stroke: var(--color-offblack);
						stroke-linecap: round;
						stroke-linejoin: round;
						stroke-width: 0;
					}
				</style>
			</defs>
			<title>Team Football Helmet</title>

			<path
				name="facemask-bg-up"
				class="outline stroke mask-shadow"
				d="m 843.93 561.73 c -4 -21.25 -8.78 -42.3 -14.78 -63.08 a 522.84 522.84 0 0 0 -18.7 -53.78 a 331.45 331.45 0 0 0 -16.34 -34.18 c -4.23 -7.66 -9.76 -9.58 -18 -6.78 c -10.3 3.51 -20.85 6.1 -31.4 8.66 a 745.74 745.74 0 0 1 -98.1 17 c -9.75 1 -19.55 1.55 -29.15 -0.69 c -21.46 -5 -40.19 -15.62 -57.44 -29 c -12.93 -10.06 -24.61 -21.47 -35.79 -33.4 a 7.9 7.9 0 0 0 -8.95 -2.29 c -6.7 2.25 -8.28 9.58 -3.15 15.2 c 17.84 19.53 37.57 36.84 60.36 50.45 c 24.23 14.46 50.16 20.88 78.49 17.48 a 833.09 833.09 0 0 0 125.7 -24.89 c 2 -0.56 3.17 -0.5 4.23 1.54 a 344.79 344.79 0 0 1 18.09 42.34 c 0.59 1.63 0.24 2.47 -1.32 3 c -3.94 1.37 -7.83 2.89 -11.81 4.14 c -16.13 5 -32.4 9.6 -48.84 13.53 a 645.77 645.77 0 0 1 -68.83 12.82 c -17.07 2.19 -34.15 0.84 -51.23 0 q -68 -3.24 -136.08 -6.49 c -0.92 0 -2.13 -0.6 -2.69 0.54 c -2.7 5.42 -5.3 10.88 -8.07 16.59 c 1.58 0.1 2.56 0.18 3.55 0.23 c 42.51 2.09 85 4 127.52 6.32 c 28.62 1.56 57.11 2.29 85.63 -2 c 33.72 -5.13 66.67 -13.21 99.23 -23.15 c 6.57 -2 13.11 -4.13 19.85 -6.25 c 8.59 25.41 15.81 50.74 18.85 77.13 a 150.15 150.15 0 0 1 -16.53 6.21 a 105.41 105.41 0 0 1 -18 3.82 c -27.13 3.23 -51.65 -2.83 -72.92 -20.48 c -10.18 -8.45 -17.71 -19.08 -24.66 -30.18 l -5.453 -9.398 l -19.837 1.385 c 9.83 17.153 15.15 26.063 21.71 34.203 c 13.37 16.55 29.63 29.27 49.5 37 c 22.73 8.87 46 9.63 69.46 3.29 c 10.07 -2.72 20 -5.86 29 -11.49 c 5.75 -3.6 8.17 -8.56 6.9 -15.35 z m -215.229 -126.718 l 6.085 -1.521 l 9.295 -1.437 c -5.351 -9.454 -6.261 -11.574 -7.351 -13.594 q -30.15 -55.46 -60.36 -110.84 c -3.48 -6.35 -6.55 -12.93 -10.67 -18.92 a 7.07 7.07 0 0 0 -7.75 -3 c -6.69 1.33 -9.38 8.23 -5.82 14.77 q 13.22 24.32 26.42 48.65 q 19.94 36.76 46.011 86.821 z m 39.662 66.139 a 155.91 155.91 0 0 0 11.65 -1.311 c -10.643 -19.72 -17.853 -33.3 -30.021 -57.095 l -7.043 1.359 l -13.082 0.8 l 27.98 50.305 l 5.222 8.896 z"
			/>
			<path
				name="facemask-bg-down"
				class="outline stroke"
				d="m 836.93 571.73 c -4 -21.25 -8.78 -42.3 -14.78 -63.08 a 522.84 522.84 0 0 0 -18.7 -53.78 a 331.45 331.45 0 0 0 -16.34 -34.18 c -4.23 -7.66 -9.76 -9.58 -18 -6.78 c -10.3 3.51 -20.85 6.1 -31.4 8.66 a 745.74 745.74 0 0 1 -98.1 17 c -9.75 1 -19.55 1.55 -29.15 -0.69 c -21.46 -5 -40.19 -15.62 -57.44 -29 c -12.93 -10.06 -24.61 -21.47 -35.79 -33.4 a 7.9 7.9 0 0 0 -8.95 -2.29 c -6.7 2.25 -8.28 9.58 -3.15 15.2 c 17.84 19.53 37.57 36.84 60.36 50.45 c 24.23 14.46 50.16 20.88 78.49 17.48 a 833.09 833.09 0 0 0 125.7 -24.89 c 2 -0.56 3.17 -0.5 4.23 1.54 a 344.79 344.79 0 0 1 18.09 42.34 c 0.59 1.63 0.24 2.47 -1.32 3 c -3.94 1.37 -7.83 2.89 -11.81 4.14 c -16.13 5 -32.4 9.6 -48.84 13.53 a 645.77 645.77 0 0 1 -68.83 12.82 c -17.07 2.19 -34.15 0.84 -51.23 0 q -68 -3.24 -136.08 -6.49 c -0.92 0 -2.13 -0.6 -2.69 0.54 c -2.7 5.42 -5.3 10.88 -8.07 16.59 c 1.58 0.1 2.56 0.18 3.55 0.23 c 42.51 2.09 85 4 127.52 6.32 c 28.62 1.56 57.11 2.29 85.63 -2 c 33.72 -5.13 66.67 -13.21 99.23 -23.15 c 6.57 -2 13.11 -4.13 19.85 -6.25 c 8.59 25.41 15.81 50.74 18.85 77.13 a 150.15 150.15 0 0 1 -16.53 6.21 a 105.41 105.41 0 0 1 -18 3.82 c -27.13 3.23 -51.65 -2.83 -72.92 -20.48 c -10.18 -8.45 -17.71 -19.08 -24.66 -30.18 l -5.453 -9.398 l -19.837 1.385 c 9.83 17.153 15.15 26.063 21.71 34.203 c 13.37 16.55 29.63 29.27 49.5 37 c 22.73 8.87 46 9.63 69.46 3.29 c 10.07 -2.72 20 -5.86 29 -11.49 c 5.75 -3.6 8.17 -8.56 6.9 -15.35 z m -215.229 -126.718 l 6.085 -1.521 l 9.295 -1.437 c -5.351 -9.454 -6.261 -11.574 -7.351 -13.594 q -30.15 -55.46 -60.36 -110.84 c -3.48 -6.35 -6.55 -12.93 -10.67 -18.92 a 7.07 7.07 0 0 0 -7.75 -3 c -6.69 1.33 -9.38 8.23 -5.82 14.77 q 13.22 24.32 26.42 48.65 q 19.94 36.76 46.011 86.821 z m 39.662 66.139 a 155.91 155.91 0 0 0 11.65 -1.311 c -10.643 -19.72 -17.853 -33.3 -30.021 -57.095 l -7.043 1.359 l -13.082 0.8 l 27.98 50.305 l 5.222 8.896 z"
			/>
			<path
				name="stripe-inner"
				class="stroke"
				style={`fill: ${trim}`}
				d="M 592.5 186.54 c -9.8 -13.48 -21.43 -25.49 -33.64 -36.87 A 273 273 0 0 0 449.14 87.24 a 285.41 285.41 0 0 0 -46.49 -9.65 a 307.23 307.23 0 0 0 -63.09 -1 a 332.74 332.74 0 0 0 -42.64 6.38 c -9.84 2.12 -19.52 4.85 -29.15 7.83 a 310.47 310.47 0 0 0 -37.23 14 a 330.35 330.35 0 0 0 -42.29 22.75 c -6.71 4.34 -13.49 8.62 -19.9 13.35 a 311.49 311.49 0 0 0 -34.62 29.59 a 299.62 299.62 0 0 0 -37.52 45.28 a 263.09 263.09 0 0 0 -43.78 177.6 c 3.33 30.79 11.57 60.23 23.21 88.83 c 4.23 10.39 9.48 20.3 14.09 30.51 a 482 482 0 0 0 35.74 65.61 c 5.32 8.14 5.36 8.11 13.65 2.34 l 58.228 -33.989 L 161.775 504.167 L 131.283 414.54 L 123.892 331.841 A 248.58 248.58 0 0 1 143.137 239.815 A 314.55 314.55 0 0 1 244.791 148.1 A 303.38 303.38 0 0 1 308.45 118.857 L 354.602 115.077 A 439.61 439.61 0 0 1 413.886 115.475 A 395.92 395.92 0 0 1 610.483 258.716 C 621.76 252.44 621.66 252.49 626.35 249.99 A 263.13 263.13 0 0 0 592.5 186.54 Z"
			/>

			<path
				name="helmet"
				class="stroke"
				style={`fill: ${helmet}`}
				d="M 474.33 520.9 C 469.33 520.71 464.33 519.63 459.33 521.42 A 13.11 13.11 0 0 1 444.33 517.72 C 440.14 513.17 440.48 507.94 442.82 502.72 C 445.82 496.13 448.94 489.63 451.95 483.06 C 454.75 476.93 457.95 470.96 460.16 464.65 C 458.78 463.35 456.8 463.65 455.36 461.76 C 455.69 461.13 456.18 460.27 456.58 459.38 C 462.04 446.95 467.58 434.57 472.87 422.05 C 474.09 419.13 475.3 418.17 478.09 419.74 C 480.42 421.04 481.42 420.1 482.47 417.74 C 487.15 407.49 492.18 397.39 496.88 387.15 C 498.33 383.99 500.64 381.15 500.93 377.55 A 13.47 13.47 0 0 1 504.72 368.71 A 18.76 18.76 0 0 0 508.32 363.28 C 513.47 352.51 518.75 341.81 523.72 330.97 C 529.62 318.11 537.21 306.17 543.72 293.65 A 10.63 10.63 0 0 1 547.47 289.15 A 58.33 58.33 0 0 0 552.94 285.58 A 139.84 139.84 0 0 1 573.09 272.71 C 585.53 266.17 598.58 261.01 611.52 255.58 C 600.02 231.03 586.43 207.7 569.42 186.58 C 549.09 161.3 524.18 141.58 495.75 125.86 C 461.15 106.72 423.58 99.8 384.9 96.3 A 285.43 285.43 0 0 0 289.55 103.85 A 297.68 297.68 0 0 0 212.33 135.35 A 305.75 305.75 0 0 0 129.85 205.13 C 109.85 229.23 93.85 255.78 83.64 285.49 A 231.9 231.9 0 0 0 70.88 373.92 C 72.46 403.35 79.38 431.58 89 459.26 C 98 485.26 110.08 509.96 123.59 533.91 C 131.59 548.15 140.31 562.02 148.53 575.76 A 3 3 0 0 0 151.41 575.17 C 155.96 571.9 160.13 572.57 165.06 575.01 C 181.9 583.34 198.95 591.24 216.06 599.01 C 219.79 600.72 222.53 602.87 223.82 606.8 A 35.87 35.87 0 0 0 225.62 610.58 C 231.24 608.33 236.62 606.14 241.99 604.02 A 130 130 0 0 1 308.93 596.47 C 331.93 599.74 353.22 607.97 374.01 618.05 C 409.16 635.11 445.61 637.57 482.95 626.18 A 142.3 142.3 0 0 0 542.4 590.87 C 560.49 572.94 573.21 552.08 574.9 525.87 C 558.58 525.03 542.27 524.16 525.9 523.35 C 508.72 522.5 491.53 521.58 474.33 520.9 Z M 376.08 595.29 C 367.74 599.29 358.54 595.9 354.55 587.44 A 15.92 15.92 0 0 1 362.38 565.86 A 16.54 16.54 0 0 1 384 573.38 A 16.32 16.32 0 0 1 376.08 595.29 Z M 416.7 512.45 C 397.06 522.28 372.39 513.8 362.58 493.84 C 352.88 474.12 361.25 449.31 380.92 439.49 C 400.14 429.89 425.33 438.29 434.87 457.49 C 445.14 478.15 437.2 502.18 416.7 512.45 Z M 513.8 559 A 16.23 16.23 0 1 1 499.66 529.78 C 507.76 525.89 517.8 529.33 521.53 537.27 A 16.35 16.35 0 0 1 513.8 559 Z M 519.57 489.19 C 512.32 487.55 505.91 483.92 499.11 481.19 C 494.58 479.39 490.3 476.92 485.48 475.73 A 177 177 0 0 0 477.07 493.92 C 489.72 494.55 501.86 495.17 514 495.75 C 529.76 496.49 545.53 497.29 561.3 497.85 C 564.61 497.97 568.04 499.04 571.3 497.48 C 570.85 491.41 568.52 485.84 566.58 480.18 C 561.66 465.89 555.19 452.18 551.25 437.52 C 550.36 434.21 548.66 431.02 549.25 427.4 C 538.86 420.12 529.36 411.75 519.64 402.73 L 505.91 431.85 C 508.44 432.95 510.56 433.85 512.64 434.79 C 519.99 438.19 527.64 440.86 534.71 444.91 C 547.44 452.26 550.8 465.62 543.22 478.1 C 538.61 485.74 529.47 491.4 519.57 489.17 Z M 612.13 283.79 C 599.39 289.04 586.8 294.56 575.62 302.85 C 573.87 304.15 573.48 305.3 574.62 306.85 C 577.01 310.02 578.32 313.79 580.44 317.1 C 586.09 312.44 591.88 307.99 597.93 303.85 C 605.93 298.39 614.69 294.42 622.93 289.49 C 628.05 286.43 632.06 282.36 632.15 275.78 A 18.7 18.7 0 0 0 626.86 277.48 Q 619.56 280.71 612.13 283.77 Z M 561 338.14 A 38.46 38.46 0 0 0 555 328 C 552.86 332.55 550.93 336.68 549 340.81 Q 540.94 357.87 532.85 374.91 C 532.28 376.11 532 377.08 533.12 378.13 C 535.92 380.75 538.65 383.44 541.43 386.08 C 542.1 386.72 542.69 387.74 543.91 387.08 C 544.75 378.72 545.51 370.35 548.18 362.31 A 76.07 76.07 0 0 1 561 338.14 Z M 632.62 275.34 L 635.03 274.18 A 1.82 1.82 0 0 0 632.57 275.34 Z M 562 339.5 L 562.93 341.29 A 1.25 1.25 0 0 0 562 339.5 Z M 544.76 389.55 L 544 388.42 C 543.71 389.16 544 389.52 544.76 389.55 Z M 582.83 320.64 L 581.83 320.38 C 582.08 320.87 582.41 320.94 582.83 320.64 Z"
			/>

			<path
				name="ear-hole-outline"
				class="ear-hole-shadow stroke"
				style={`fill: ${earOutline}`}
				d="M 839.93 566.73 Z M 416.7 512.5 C 437.2 502.23 445.14 478.2 434.87 457.5 C 425.33 438.32 400.14 429.92 380.92 439.5 C 361.25 449.32 352.92 474.13 362.58 493.85 C 372.39 513.8 397.06 522.28 416.7 512.45 Z M 366.22 491.56 A 36.21 36.21 0 0 1 383.22 443.5 C 400.88 434.97 423.1 442.59 431.58 460.09 C 440.16 477.78 432.35 499.95 414.52 508.51 A 36.09 36.09 0 0 1 366.22 491.51 Z"
			/>

			<path
				name="ear-hole"
				class="ear-hole stroke"
				d="M 383.2 443.45 a 36.08 36.08 0 1 0 31.3 65 c 17.83 -8.56 25.64 -30.73 17.06 -48.42 C 423.08 442.54 400.86 434.92 383.2 443.45 Z"
			/>

			<path
				name="stripe-outer"
				class="stroke"
				style={`fill: ${stripe}`}
				d="M 592.5 186.54 c -9.8 -13.48 -21.43 -25.49 -33.64 -36.87 A 273 273 0 0 0 449.14 87.24 a 285.41 285.41 0 0 0 -46.49 -9.65 a 307.23 307.23 0 0 0 -63.09 -1 a 332.74 332.74 0 0 0 -42.64 6.38 c -9.84 2.12 -19.52 4.85 -29.15 7.83 a 310.47 310.47 0 0 0 -37.23 14 a 330.35 330.35 0 0 0 -42.29 22.75 c -6.71 4.34 -13.49 8.62 -19.9 13.35 a 311.49 311.49 0 0 0 -34.62 29.59 a 299.62 299.62 0 0 0 -37.52 45.28 a 263.09 263.09 0 0 0 -43.78 177.6 c 3.33 30.79 11.57 60.23 23.21 88.83 c 4.23 10.39 9.48 20.3 14.09 30.51 a 482 482 0 0 0 35.74 65.61 c 5.32 8.14 5.36 8.11 13.65 2.34 c -0.56 -1.07 -1.05 -2.18 -1.68 -3.2 c -9.72 -15.68 -19.33 -31.42 -28.19 -47.61 c -19.4 -35.44 -34.72 -72.44 -43.39 -112 c -6.94 -31.73 -8.52 -63.53 -3 -95.76 a 248.58 248.58 0 0 1 31.09 -84.89 c 15 -25.54 33.75 -48.08 55.34 -68.31 a 314.55 314.55 0 0 1 79.37 -54.15 a 303.38 303.38 0 0 1 66.11 -23 c 20.52 -4.54 41.29 -7.41 62.3 -7.34 a 439.61 439.61 0 0 1 70.45 6.41 c 38.5 6.41 73 22 104.38 44.81 a 238.65 238.65 0 0 1 56.91 58.82 a 395.92 395.92 0 0 1 30.73 53.31 c 2.22 4.69 2.12 4.74 6.81 2.24 A 263.13 263.13 0 0 0 592.5 186.54 Z"
			/>

			<path
				name="outline"
				class="outline stroke"
				d="M 839.93 566.73 Z M 574.87 525.88 C 573.18 552.13 560.46 572.99 542.37 590.88 A 142.3 142.3 0 0 1 482.92 626.19 C 445.58 637.58 409.13 635.12 373.98 618.06 C 353.19 607.98 331.88 599.75 308.9 596.48 A 130 130 0 0 0 242 604.07 C 236.61 606.19 231.25 608.38 225.63 610.63 A 35.87 35.87 0 0 1 223.83 606.85 C 222.54 602.92 219.83 600.77 216.07 599.06 C 198.99 591.24 181.94 583.34 165.07 575.06 C 160.14 572.62 155.97 571.95 151.42 575.22 L 148.179 576.474 L 143.306 578.423 L 138.936 580.283 C 130.646 586.053 130.606 586.083 125.286 577.943 A 482 482 0 0 1 89.546 512.333 C 84.936 502.123 79.686 492.213 75.456 481.823 C 63.816 453.223 55.576 423.823 52.246 392.993 A 263.09 263.09 0 0 1 96.026 215.393 A 299.62 299.62 0 0 1 133.546 170.113 A 311.49 311.49 0 0 1 168.166 140.523 C 174.576 135.793 181.356 131.523 188.066 127.173 A 330.35 330.35 0 0 1 230.356 104.423 A 310.47 310.47 0 0 1 267.586 90.423 C 277.216 87.423 286.896 84.713 296.736 82.593 A 332.74 332.74 0 0 1 339.376 76.213 A 307.23 307.23 0 0 1 402.466 77.213 A 285.41 285.41 0 0 1 448.956 86.863 A 273 273 0 0 1 558.676 149.293 C 570.886 160.673 582.516 172.683 592.316 186.163 A 263.13 263.13 0 0 1 626.096 249.703 A 94.37 94.37 0 0 0 641.096 244.143 C 634.396 230.243 627.896 216.733 621.276 202.993 L 612.176 207.373 C 611.686 206.613 611.306 206.083 610.986 205.523 C 599.07 184.62 583.6 166 566 149.26 C 525.11 110.41 476.9 85.59 421.36 75.66 C 354.29 63.66 289.86 73.51 227.91 101.01 A 330.33 330.33 0 0 0 155.81 144.93 C 122.27 171.69 94.99 203.64 75.33 241.93 A 262.46 262.46 0 0 0 46.48 345.93 C 44.48 376.93 47.82 407.45 55.6 437.5 C 61.23 459.25 69.35 480.09 78.51 500.57 C 90.95 528.4 105.03 555.32 121.71 580.86 C 123.19 583.12 125.71 585.18 125.65 587.86 A 8.51 8.51 0 0 0 127.77 593.43 C 129.13 595.28 130.38 597.23 131.58 599.2 C 138.12 609.96 141.29 621.95 144.15 634.05 C 145.52 639.87 148.7 642.64 154.75 643.54 C 161.22 644.54 167.45 643.28 173.56 641.42 C 189.31 636.61 203.92 629.28 218.12 621.07 C 220.78 619.53 223.9 618.36 225.86 616.17 A 16.47 16.47 0 0 1 232.55 611.83 A 198.78 198.78 0 0 1 252.16 605.11 C 282.82 596.58 313.07 597.42 342.92 608.85 C 357.8 614.55 371.66 622.54 386.63 628.09 C 394.48 631 402.3 633.91 410.55 635.32 C 455.46 643 496.18 632.59 532.85 606.09 C 551.75 592.42 565.94 574.81 573.95 552.63 A 88.89 88.89 0 0 0 579.36 526.05 A 8.9 8.9 0 0 0 574.87 525.88 Z M 218.19 615.43 A 281.78 281.78 0 0 1 184.71 632.43 C 177.53 635.43 170.21 638.16 162.38 639.08 A 22.58 22.58 0 0 1 155.18 639.08 C 151.48 638.33 149 636.55 148.06 632.43 C 145.6 621.62 142.71 610.9 137.49 601 C 135.49 597.24 133.27 593.62 130.97 589.61 C 136.9 586.75 143.03 584.45 148.46 581.03 C 155.36 576.68 161.2 577.24 168.36 581.03 C 183.7 589.09 199.56 596.19 215.31 603.47 C 219.31 605.32 219.99 609.11 221.37 612.38 C 222.08 614 219.49 614.66 218.19 615.43 Z M 647.55 242.52 C 654.08 240.52 660.55 243.52 663.55 250.01 C 666.3 255.93 664.42 261.6 658.55 265.58 A 18.86 18.86 0 0 1 651.55 268.43 C 649.27 268.89 647.38 270.01 645.06 270.95 C 647.62 273.26 650.8 273.72 653.27 275.3 C 651 286.04 639.72 293.47 629.27 291 C 635.27 286.1 639.81 280.45 641.1 272.16 L 634.99 274.16 L 632.58 275.32 A 0.61 0.61 0 0 1 632.21 275.76 C 632.12 282.34 628.11 286.41 622.99 289.47 C 614.74 294.4 605.99 298.37 597.99 303.83 C 591.94 307.97 586.15 312.42 580.5 317.08 C 580.96 318.18 581.43 319.27 581.89 320.36 L 582.89 320.62 C 595.45 310.14 609.71 302.45 624.36 295.43 A 2.54 2.54 0 0 1 626.2 295.36 C 635.2 297.31 643.52 295.64 650.45 289.55 C 655.45 285.17 658.83 279.7 657.45 272.5 C 657.32 272.41 657.06 272.31 657.06 272.24 C 657.06 271.89 657.33 271.8 657.65 271.94 C 658.65 271.74 659.59 271.56 660.55 271.35 C 666.8 269.95 671.17 266.35 673.28 260.24 C 675.28 254.54 673.47 249.34 670.57 244.55 C 663.24 232.44 655.73 220.45 648.26 208.43 C 645.43 203.89 642.51 199.43 639.64 194.93 L 625.28 201.84 L 645.2 243.2 Z M 571.32 497.49 C 572.98 499.86 575.15 498.32 577.32 498.49 A 105.8 105.8 0 0 0 570.71 476.56 A 343.77 343.77 0 0 1 555.88 436.14 A 13.33 13.33 0 0 0 549.23 427.39 C 548.63 431.01 550.33 434.2 551.23 437.51 C 555.17 452.14 561.64 465.88 566.56 480.17 C 568.54 485.85 570.87 491.42 571.32 497.49 Z M 544.76 389.55 L 548.21 392.41 C 548.39 389.54 548.56 387.04 548.71 384.54 A 86.42 86.42 0 0 1 557 352.21 C 558.8 348.45 561.64 345.29 562.95 341.29 L 562 339.5 L 561 338.14 A 76.07 76.07 0 0 0 548.21 362.32 C 545.54 370.32 544.78 378.73 543.94 387.09 C 543.94 387.53 544.01 387.97 544.05 388.42 Z"
			/>

			<path
				name="top-clasp"
				class="white"
				d="m 614 210 z a 213.1353 213.1353 90 0 1 17.836 39.025 a 76.4397 76.4397 90 0 0 8.5 -3.352 l -18.555 -39.862 z m 34.2335 33.4182 c 5.2893 -1.62 10.53 0.81 12.96 6.0669 c 2.2275 4.7952 0.7047 9.3879 -4.05 12.6117 a 15.2766 15.2766 90 0 1 -5.67 2.3085 c 5.751 2.6811 6.5124 2.5353 7.29 2.3652 c 5.0625 -1.134 8.6022 -4.05 11.2595 -7.3315 c 0.6718 -6.2846 -0.7943 -10.4966 -3.1433 -14.3765 c -5.9373 -9.8091 -12.0204 -19.521 -18.0711 -29.2572 c -2.2923 -3.6774 -4.6575 -7.29 -10.0296 -16.6983 l -9.576 4.549 l 19.632 39.503 z"
			/>

			<path
				name="facemask"
				class="stroke"
				style={`fill: ${faceMask}`}
				d="m 839.93 566.73 c -4 -21.25 -8.78 -42.3 -14.78 -63.08 a 522.84 522.84 0 0 0 -18.7 -53.78 a 331.45 331.45 0 0 0 -16.34 -34.18 c -4.23 -7.66 -9.76 -9.58 -18 -6.78 c -10.3 3.51 -20.85 6.1 -31.4 8.66 a 745.74 745.74 0 0 1 -98.1 17 c -9.75 1 -19.55 1.55 -29.15 -0.69 c -21.46 -5 -40.19 -15.62 -57.44 -29 c -12.93 -10.06 -24.61 -21.47 -35.79 -33.4 a 7.9 7.9 0 0 0 -8.95 -2.29 c -6.7 2.25 -8.28 9.58 -3.15 15.2 c 17.84 19.53 37.57 36.84 60.36 50.45 c 24.23 14.46 50.16 20.88 78.49 17.48 a 833.09 833.09 0 0 0 125.7 -24.89 c 2 -0.56 3.17 -0.5 4.23 1.54 a 344.79 344.79 0 0 1 18.09 42.34 c 0.59 1.63 0.24 2.47 -1.32 3 c -3.94 1.37 -7.83 2.89 -11.81 4.14 c -16.13 5 -32.4 9.6 -48.84 13.53 a 645.77 645.77 0 0 1 -68.83 12.82 c -17.07 2.19 -34.15 0.84 -51.23 0 q -68 -3.24 -136.08 -6.49 c -0.92 0 -2.13 -0.6 -2.69 0.54 c -2.7 5.42 -5.3 10.88 -8.07 16.59 c 1.58 0.1 2.56 0.18 3.55 0.23 c 42.51 2.09 85 4 127.52 6.32 c 28.62 1.56 57.11 2.29 85.63 -2 c 33.72 -5.13 66.67 -13.21 99.23 -23.15 c 6.57 -2 13.11 -4.13 19.85 -6.25 c 8.59 25.41 15.81 50.74 18.85 77.13 a 150.15 150.15 0 0 1 -16.53 6.21 a 105.41 105.41 0 0 1 -18 3.82 c -27.13 3.23 -51.65 -2.83 -72.92 -20.48 c -10.18 -8.45 -17.71 -19.08 -24.66 -30.18 c -0.81 -1.3 -1.1 -3.21 -3.42 -2.89 c -5.52 0.77 -11 1.43 -17.16 2.21 c 5.12 9.82 10.44 18.73 17 26.87 c 13.37 16.55 29.63 29.27 49.5 37 c 22.73 8.87 46 9.63 69.46 3.29 c 10.07 -2.72 20 -5.86 29 -11.49 c 5.75 -3.6 8.17 -8.56 6.9 -15.35 z m -225.54 -139.04 c 0.42 0.78 0.74 1.57 1.77 1.76 a 59.28 59.28 0 0 0 19.79 0.67 c -1.22 -2.52 -2.13 -4.64 -3.22 -6.66 q -30.15 -55.46 -60.36 -110.84 c -3.48 -6.35 -6.55 -12.93 -10.67 -18.92 a 7.07 7.07 0 0 0 -7.75 -3 c -6.69 1.33 -9.38 8.23 -5.82 14.77 q 13.22 24.32 26.42 48.65 q 19.94 36.76 39.84 73.57 z m -43.45 -127.82 c 1.55 -1.21 2.78 -2.29 4.12 -3.19 c 14.5 -9.78 30.6 -16.29 46.72 -22.69 c 10.61 -4.21 21.42 -7.9 32.35 -11.21 a 8 8 0 0 0 5.7 -10 c -1.49 -5.1 -5.24 -7.31 -10.31 -6 c -1.49 0.38 -2.95 0.87 -4.4 1.36 c -13.32 4.53 -26.41 9.64 -39.42 14.95 c -13.53 5.52 -27 11.21 -39.51 18.83 c -2.17 1.33 -4.58 2.45 -6.39 4.79 c 6.04 2.44 7.61 8.42 11.14 13.16 z m -19.26 21.59 c -2.7 -5.47 -5.32 -11 -8.11 -16.77 c -3.74 3.78 -29 53.84 -30.2 59.2 c 3.07 0.61 6.39 0.69 8.86 2.93 s 4.61 4.58 7 7 a 10.81 10.81 0 0 0 0.74 -1.18 c 7 -16.1 13.94 -32.23 21.58 -48 a 3.22 3.22 0 0 0 0.13 -3.18 z m -100.93 195.32 c 4.75 2.22 9.72 0.78 12 -4 c 6.17 -12.84 12.11 -25.79 18.27 -39 l -16.42 -7.33 c -6.06 13.09 -12.06 25.89 -17.9 38.76 c -2.3 5.13 -0.7 9.36 4.05 11.57 z m 205 -15.95 a 155.91 155.91 0 0 0 17.09 -1.71 c -7.47 -14 -14.68 -27.58 -21.87 -41.12 c -0.37 -0.7 -0.71 -1.31 -1.7 -1.23 c -5.84 0.48 -11.68 0.92 -17.8 1.39 c 7.45 14 14.72 27.6 22 41.24 a 2.25 2.25 0 0 0 2.28 1.43 z m -152.93 -115.7 c -5.94 12.8 -11.69 25.16 -17.51 37.68 l 16.77 7.11 l 13.56 -29 c 0.34 -0.71 0.69 -1.46 -0.06 -2.1 c -4.64 -3.96 -8.45 -8.75 -12.76 -13.69 z
M 641.087 272.197 L 641.11 272.25 C 639.82 280.54 635.28 286.19 629.28 291.09 C 639.73 293.56 651.01 286.09 653.28 275.39 C 650.81 273.81 647.63 273.39 641.131 272.249 Z"
			/>

			<path
				name="mask-clasp-bg"
				class="outline stroke clasp-shadow"
				d="m 904 587 z m -373.752 -98.652 c 9.3 -3.144 16.14 -12.528 16.656 -22.8 c 0.48 -9.72 -3.924 -16.44 -14.088 -21.012 q -31.2 -14.04 -56.994 -25.125 a 2.748 2.748 90 0 0 -2.568 -0.372 l -18.828 42.42 c 0.456 0.456 0.6 0.708 0.816 0.804 l 60.042 25.137 a 20.58 20.58 90 0 0 14.964 0.948 z"
			/>

			<path
				name="mask-clasp-screws"
				class="snaps-outline stroke"
				d="M 839.93 566.73 Z M 528.47 484.52 C 536.22 481.9 541.92 474.08 542.35 465.52 C 542.75 457.42 539.08 451.82 530.61 448.01 Q 504.61 436.31 478.61 424.75 A 2.29 2.29 0 0 0 476.47 424.44 L 460.78 459.79 C 461.16 460.17 461.28 460.38 461.46 460.46 Q 488.7 472.1 516 483.73 A 17.15 17.15 0 0 0 528.47 484.52 Z"
			/>

			<path
				name="mask-clasp"
				class="white stroke"
				d="M 839.93 566.73 Z M 528.47 484.52 C 536.22 481.9 541.92 474.08 542.35 465.52 C 542.75 457.42 539.08 451.82 530.61 448.01 Q 504.61 436.31 478.61 424.75 A 2.29 2.29 0 0 0 476.47 424.44 L 460.78 459.79 C 461.16 460.17 461.28 460.38 461.46 460.46 Q 488.7 472.1 516 483.73 A 17.15 17.15 0 0 0 528.47 484.52 Z M 512.47 472.18 C 511.47 470.24 510.47 469.9 508.47 470.04 A 10.91 10.91 0 0 1 497.39 462.04 C 496.01 456.13 498.16 451.47 503.39 448.98 A 10.29 10.29 0 0 1 516.49 452.35 C 517.68 454.02 518.79 453.75 520.4 453.44 C 526.84 452.2 533.29 455.87 535.13 461.68 A 13 13 0 0 1 528.73 477.06 C 522.93 479.92 515.47 477.84 512.48 472.18 Z"
			/>
			<path
				name="neck-pad"
				class="white stroke"
				d="M 215.31 603.37 c -15.75 -7.28 -31.61 -14.38 -46.95 -22.44 c -7.16 -3.76 -13 -4.32 -19.9 0 c -5.43 3.42 -11.56 5.72 -17.49 8.58 c 2.3 4 4.54 7.63 6.52 11.39 c 5.22 9.9 8.11 20.62 10.57 31.43 c 0.94 4.12 3.42 5.9 7.12 6.65 a 22.58 22.58 0 0 0 7.2 0 c 7.83 -0.92 15.15 -3.62 22.33 -6.65 a 281.78 281.78 0 0 0 33.48 -17 c 1.3 -0.77 3.89 -1.48 3.18 -3.15 C 220 609 219.32 605.22 215.31 603.37 Z"
			/>

			<path
				name="snaps-outline"
				class="snaps-outline stroke"
				d="M 839.93 566.73 Z M 512.47 472.18 C 511.47 470.24 510.47 469.9 508.47 470.04 A 10.91 10.91 0 0 1 497.39 462.04 C 496.01 456.13 498.16 451.47 503.39 448.98 A 10.29 10.29 0 0 1 516.49 452.35 C 517.68 454.02 518.79 453.75 520.4 453.44 C 526.84 452.2 533.29 455.87 535.13 461.68 A 13 13 0 0 1 528.73 477.06 C 522.93 479.92 515.47 477.84 512.48 472.18 Z M 362.38 565.91 A 15.92 15.92 0 0 0 354.55 587.49 C 358.55 595.95 367.74 599.3 376.08 595.34 A 16.32 16.32 0 0 0 384 573.38 A 16.54 16.54 0 0 0 362.38 565.86 Z M 373.73 589.91 A 10.3 10.3 0 1 1 378.73 576.2 A 10.53 10.53 0 0 1 373.73 589.91 Z M 381.43 581.27 C 380.04 573.76 377.03 570.06 371.51 569.04 A 11.47 11.47 0 0 0 359.38 574.38 C 355.9 580.38 357.38 585.69 362.38 590.38 C 360.73 591.99 359.88 590.97 359.03 590.13 C 355.03 586.22 354.24 579.21 357.12 573.93 A 14.06 14.06 0 0 1 371.91 567.03 C 377.97 568.3 382.55 573.2 383.04 578.92 C 383.11 580.19 383.4 581.47 381.43 581.27 Z M 513.8 559 A 16.35 16.35 0 0 0 521.53 537.27 C 517.8 529.33 507.76 525.89 499.66 529.78 A 16.23 16.23 0 1 0 513.8 559 Z M 511.25 553.7 A 10.68 10.68 0 0 1 497.5 548.7 A 10.4 10.4 0 0 1 502.5 535.05 A 10.29 10.29 0 1 1 511.25 553.67 Z M 497.19 534.2 A 13.78 13.78 0 0 1 516.46 534.4 A 14.1 14.1 0 0 1 520.55 542.79 C 520.69 543.79 520.71 544.73 518.95 545.35 C 518.29 539.35 516.05 534.51 509.78 532.89 A 11.93 11.93 0 0 0 495.06 544.24 C 494.87 548.39 497.01 551.45 499.98 554.17 C 498.14 555.74 497.34 554.61 496.42 553.67 C 491.3 548.49 491.64 539.73 497.19 534.2 Z M 527.39 474.49 C 532.19 472.05 534.29 466.32 532.05 461.73 S 523.72 454.73 519.25 456.88 C 514.57 459.08 512.25 465.46 514.57 470 S 522.88 476.78 527.39 474.49 Z M 522.39 470.49 C 518.65 470.18 521.7 467.8 521.18 466.36 L 516.64 464.12 C 517.37 461.93 517.37 461.93 522.64 463.62 C 524.14 463.48 523.12 459.8 525.84 461.32 C 526.43 462.67 524.65 463.68 525.33 464.98 C 530.04 467.54 530.04 467.54 529.04 469.69 L 524.36 467.82 C 523.16 468.37 523.38 469.84 522.4 470.5 Z M 512.86 452.76 A 8.56 8.56 0 0 0 502.21 453.34 A 8.24 8.24 0 0 0 500.75 462.75 C 502.75 466.61 505.68 467.81 510.61 466.6 C 510.73 463.19 511.25 460.04 513.68 457.68 C 515.91 455.53 514.87 454.1 512.87 452.77 Z M 366 574.16 A 7.14 7.14 0 0 0 362.55 583.62 A 7.4 7.4 0 0 0 372.26 587.29 A 7.14 7.14 0 0 0 375.81 577.38 A 7.27 7.27 0 0 0 366 574.16 Z M 371.79 585.53 C 369.2 586.79 366.39 586.23 365.37 584.24 S 365.81 579.58 368.58 578.24 C 371.2 576.93 374.1 577.48 374.97 579.44 S 374.44 584.26 371.82 585.53 Z M 503.42 537.94 A 7 7 0 0 0 500.17 547.42 A 7.32 7.32 0 1 0 513.35 541.07 A 7.52 7.52 0 0 0 503.45 537.94 Z M 509.3 549.27 C 506.68 550.54 503.87 550.03 502.83 548.1 S 503.38 543.33 506.01 542.01 S 511.41 541.14 512.36 543.2 S 512.1 547.94 509.33 549.27 Z"
			/>

			<path
				name="snaps"
				class="snaps snap-shadow stroke"
				d="M 508.46 470 C 510.46 469.86 511.46 470.2 512.46 472.14 C 515.46 477.8 522.91 479.88 528.74 477.03 A 13 13 0 0 0 535.14 461.65 C 533.3 455.84 526.85 452.17 520.41 453.41 C 518.8 453.72 517.69 453.99 516.5 452.32 A 10.29 10.29 0 0 0 503.4 448.95 C 498.13 451.44 495.98 456.1 497.4 462.01 A 10.91 10.91 0 0 0 508.46 470 Z M 519.25 456.84 C 523.72 454.73 529.79 457.03 532.05 461.69 S 532.19 472.01 527.39 474.45 C 522.88 476.74 516.91 474.65 514.57 469.96 S 514.57 459.08 519.25 456.88 Z M 502.25 453.31 A 8.56 8.56 0 0 1 512.9 452.73 C 514.9 454.06 515.9 455.49 513.72 457.65 C 511.29 460.01 510.72 463.16 510.65 466.57 C 505.72 467.78 502.78 466.57 500.79 462.72 A 8.24 8.24 0 0 1 502.22 453.35 Z M 364.67 571.45 A 10.3 10.3 0 0 0 373.73 589.94 A 10.3 10.3 0 1 0 364.67 571.45 Z M 372.29 587.32 A 7.4 7.4 0 0 1 362.58 583.65 A 7.14 7.14 0 0 1 366.03 574.19 A 7.27 7.27 0 0 1 375.84 577.41 A 7.14 7.14 0 0 1 372.29 587.29 Z M 371.88 567.08 A 14.06 14.06 0 0 0 357.09 573.98 C 354.21 579.26 355.03 586.27 359 590.18 C 359.85 591.02 360.7 592.04 362.35 590.43 C 357.42 585.72 355.9 580.43 359.35 574.43 A 11.47 11.47 0 0 1 371.51 569 C 377.03 570 380.04 573.72 381.43 581.23 C 383.43 581.43 383.11 580.15 383.01 578.9 C 382.52 573.22 377.94 568.32 371.88 567.05 Z M 502.5 535.08 A 10.4 10.4 0 0 0 497.5 548.73 A 10.33 10.33 0 1 0 516.07 539.68 A 10.54 10.54 0 0 0 502.5 535.06 Z M 510.16 550.93 A 7.23 7.23 0 0 1 500.16 547.44 A 7 7 0 0 1 503.41 537.96 A 7.52 7.52 0 0 1 513.34 541.09 A 7.27 7.27 0 0 1 510.16 550.91 Z M 516.46 534.42 A 13.78 13.78 0 0 0 497.19 534.22 C 491.64 539.75 491.3 548.51 496.42 553.69 C 497.34 554.63 498.14 555.76 499.98 554.19 C 496.98 551.47 494.87 548.41 495.06 544.26 A 11.93 11.93 0 0 1 509.78 532.91 C 516.05 534.53 518.29 539.38 518.95 545.37 C 520.71 544.75 520.69 543.84 520.55 542.81 A 14.1 14.1 0 0 0 516.46 534.4 Z M 522.4 470.52 C 523.4 469.86 523.16 468.39 524.4 467.85 L 529.08 469.72 C 530.08 467.57 530.08 467.57 525.37 465.01 C 524.69 463.71 526.47 462.7 525.88 461.35 C 523.16 459.83 524.18 463.51 522.68 463.65 C 517.38 461.96 517.38 461.96 516.68 464.15 L 521.22 466.39 C 521.71 467.81 518.66 470.19 522.4 470.5 Z M 368.59 578.16 C 365.82 579.53 364.38 582.23 365.38 584.16 S 369.21 586.71 371.8 585.45 S 375.88 581.36 374.98 579.33 S 371.23 576.9 368.61 578.21 Z M 506 542 C 503.37 543.32 501.83 546.26 502.82 548.09 S 506.67 550.53 509.29 549.26 C 512.06 547.93 513.35 545.35 512.35 543.19 S 508.76 540.64 506 542 Z"
			/>
		</svg>
	</div>
	{#if logo}
		<div
			class="logo-container"
			class:small={size === HELMET_SIZE.SMALL}
			class:large={size === HELMET_SIZE.LARGE}
			on:click={canCustomize ? toggleMoveableTarget : NOOP}
			on:keydown={canCustomize ? toggleMoveableTarget : NOOP}
			on:dblclick={canCustomize ? toggleMoveableTarget : NOOP}
			role="button"
			tabindex="0"
		>
			<img
				alt={`${logo} Logo`}
				bind:this={target}
				class="target"
				src={`/logos/${direction === POSITION.LEFT && logoLeft ? logoLeft : logo}.webp`}
				style={`
				width: ${logoWidth}px; 
				transform: ${logoFixed ? logoTransform.replace('scale(', 'scale(-') : logoTransform}
			`}
				class:flipRight={logoFixed}
			/>
		</div>
		{#if canCustomize}
			<Moveable
				target={moveable}
				origin={true}
				edge={false}
				draggable={true}
				on:drag={({ detail }) => onTransform(detail.transform)}
				throttleDrag={0}
				keepRatio={false}
				renderDirections={['nw', 'ne', 'sw', 'se', 'n', 'w', 's', 'e']}
				throttleScale={0}
				rotatable={true}
				scalable={true}
				snappable={true}
				bounds={{ left: 0, top: 0, right: 0, bottom: 0, position: 'css' }}
				on:scale={({ detail }) => onTransform(detail.transform)}
				throttleRotate={0}
				on:rotate={({ detail }) => onTransform(detail.transform)}
				warpable={false}
				on:warp={({ detail }) => onTransform(detail.transform)}
			/>
		{/if}
	{/if}
</div>

<style>
	.helmet-wrapper {
		display: flex;
		position: relative;
	}

	.helmet-rotate {
		transform: rotate(20deg);
	}

	.shadow {
		filter: drop-shadow(4px 8px 8px hsl(0deg 0% 5% / 0.5));
	}

	.end-zone-shadow {
		filter: drop-shadow(0px 0px 1px hsl(0deg 0% 5% / 0.5));
	}

	.small {
		width: 3rem;
		height: 3rem;
	}
	.large {
		width: 275px;
		height: 250px;
	}
	.logo-container {
		position: absolute;
		top: 0;
		display: flex;
		justify-content: center;
		align-items: center;
	}

	.flipRight {
		transform: scale(-1, 1);
	}

	@media (max-width: 40rem) {
		.small {
			width: 2rem;
			height: 2rem;
		}
	}
	@media (min-width: 60rem) {
		.small {
			width: 4rem;
			height: 4rem;
		}
	}
</style>
